<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>COE301 LAB NOTES</title>
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="solarized-dark.min.css" />
<link rel="stylesheet" type="text/css" href="style.css" />
</head>
<body>
<div id="content" class="content">
<h1 class="title">COE301 LAB NOTES</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orge02d891">Resources</a></li>
<li><a href="#org21a0598">MIPS assembly</a>
<ul>
<li><a href="#org47e7dd7">Introduction</a>
<ul>
<li><a href="#orgb8fe4e1">Mars simulator Setup</a></li>
<li><a href="#orgf719e9b">Hello, World</a></li>
<li><a href="#org2b0c7c6">More about MIPS assembly</a></li>
<li><a href="#orgf14c35f">Basic Syscalls</a></li>
<li><a href="#orgce3e756">Registers</a></li>
</ul>
</li>
<li><a href="#org2f131af">instructions</a></li>
<li><a href="#org0f7a16f">Labs</a>
<ul>
<li><a href="#org955b115">LAB 3</a></li>
<li><a href="#org31ec7b0">LAB 4</a></li>
<li><a href="#org5b7f456">LAB 5</a></li>
</ul>
</li>
<li><a href="#org56a717e">Useful Macros</a></li>
</ul>
</li>
</ul>
</div>
</div>
<blockquote>
<ul class="org-ul">
<li>I recommend viewing this website on a non mobile device</li>
<li>Github repositary of this document <a href="https://github.com/Airbus5717/coe301">repo</a> which contains Term221 resources too</li>
<li>If you find any issue, report it here <a href="https://github.com/Airbus5717/coe301/issues">report issue</a></li>
</ul>
</blockquote>

<div id="outline-container-orge02d891" class="outline-2">
<h2 id="orge02d891">Resources</h2>
<div class="outline-text-2" id="text-orge02d891">
<ul class="org-ul">
<li>Dr. Mudawar resources <a href="https://faculty.kfupm.edu.sa/coe/mudawar/coe301/lectures/index.htm">slides, examples etc.</a></li>
<li>MIPS syscalls <a href="https://courses.missouristate.edu/kenvollmar/mars/help/syscallhelp.html">link</a></li>
<li>Mars mips simulator <a href="https://courses.missouristate.edu/KenVollmar/mars/download.htm">link</a></li>
<li>Dr. Mudawwar&rsquo;s videos <a href="https://youtube.com/playlist?list=PLeurb_BIjrxjSmBhm_h3TkN8pWxM_1ViU">link</a></li>
<li>MIPS assembly reference <a href="https://uweb.engr.arizona.edu/~ece369/Resources/spim/MIPSReference.pdf">arizona uni</a></li>
<li>Mips assembly videos <a href="https://www.youtube.com/playlist?list=PL1C2GgOjAF-KYdV5bH-xzoybEHreDZ3Kh">Padraic Edgington</a></li>
<li>Mips assembly videos <a href="https://www.youtube.com/playlist?list=PL5b07qlmA3P6zUdDf-o97ddfpvPFuNa5A">Amell Peralta</a></li>
<li>Mips assembly Slides from oregon state uni <a href="https://web.engr.oregonstate.edu/~walkiner/cs271-wi13/slides/">class 2013</a></li>
<li>MIPS online editor/simulator <a href="https://cpulator.01xz.net/?sys=mipsr5-spim">CPULATOR</a></li>
<li>MIPS Manual I <a href="https://faculty.kfupm.edu.sa/coe/mudawar/coe301/tools_manuals/MIPS32Vol1.Architecture.pdf">MANUAL I</a></li>
<li>MIPS Manual II <a href="https://faculty.kfupm.edu.sa/coe/mudawar/coe301/tools_manuals/MIPS32Vol2.InstructionSet.pdf">MANUAL II</a></li>
</ul>
<hr />
</div>
</div>

<div id="outline-container-org21a0598" class="outline-2">
<h2 id="org21a0598">MIPS assembly</h2>
<div class="outline-text-2" id="text-org21a0598">
</div>
<div id="outline-container-org47e7dd7" class="outline-3">
<h3 id="org47e7dd7">Introduction</h3>
<div class="outline-text-3" id="text-org47e7dd7">
</div>
<div id="outline-container-orgb8fe4e1" class="outline-4">
<h4 id="orgb8fe4e1">Mars simulator Setup</h4>
<div class="outline-text-4" id="text-orgb8fe4e1">
<ol class="org-ol">
<li>File (or Ctrl-N) -&gt; New File</li>
<li>Copy paste the code below</li>
<li>Save the file (or Ctrl-S)</li>
<li>Run (or F3) -&gt; Assemble</li>
<li>If assembling was successful then continue</li>
<li>Go (or F5) to run the whole program at once</li>
</ol>
</div>
</div>


<div id="outline-container-orgf719e9b" class="outline-4">
<h4 id="orgf719e9b">Hello, World</h4>
<div class="outline-text-4" id="text-orgf719e9b">
<div class="org-src-container">
<pre class="src src-mips"><span style="color: #928374;"># </span><span style="color: #b8bb26; font-weight: bold;">NOTE:</span><span style="color: #928374;"> Hello, World in assembly</span>
<span style="color: #ebdbb2; font-weight: bold;">.globl</span> main

<span style="color: #928374;"># </span><span style="color: #928374;">data segment (global variables)</span>
<span style="color: #ebdbb2; font-weight: bold;">.data</span>
<span style="color: #b8bb26;">msg:</span> <span style="color: #ebdbb2; font-weight: bold;">.asciiz</span> <span style="color: #b8bb26;">"Hello, World\n"</span>
    <span style="color: #928374;"># </span><span style="color: #928374;">asciiz includes the null terminator (\0) in string</span>

<span style="color: #928374;"># </span><span style="color: #928374;">code segment</span>
<span style="color: #ebdbb2; font-weight: bold;">.text</span>
<span style="color: #b8bb26;">main:</span>
    <span style="color: #928374;"># </span><span style="color: #928374;">print string msg</span>
    <span style="color: #928374;"># </span><span style="color: #928374;">4 is the syscall number for print string</span>
    <span style="color: #83a598;">la</span> <span style="color: #fabd2f;">$a0</span><span style="color: #fe8019;">,</span> msg <span style="color: #928374;"># </span><span style="color: #928374;">loads address of msg to $a0</span>
    <span style="color: #83a598;">li</span> <span style="color: #fabd2f;">$v0</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">4</span>   <span style="color: #928374;"># </span><span style="color: #928374;">loads immediate (4) to $v0</span>
    <span style="color: #fb4934;">syscall</span>

    <span style="color: #928374;"># </span><span style="color: #928374;">exit</span>
    <span style="color: #928374;"># </span><span style="color: #928374;">exit syscall is 10</span>
    <span style="color: #83a598;">li</span> <span style="color: #fabd2f;">$v0</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">10</span> 
    <span style="color: #fb4934;">syscall</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2b0c7c6" class="outline-4">
<h4 id="org2b0c7c6">More about MIPS assembly</h4>
<div class="outline-text-4" id="text-org2b0c7c6">
<p>
MIPS assembly was introduced in 1986 and there are different versions (I, I, &#x2026;, MIPS32, MIPS64).
</p>
</div>
</div>

<div id="outline-container-orgf14c35f" class="outline-4">
<h4 id="orgf14c35f">Basic Syscalls</h4>
<div class="outline-text-4" id="text-orgf14c35f">
<p>
Full reference MIPS syscalls <a href="https://courses.missouristate.edu/kenvollmar/mars/help/syscallhelp.html">link</a>
</p>
</div>
</div>

<div id="outline-container-orgce3e756" class="outline-4">
<h4 id="orgce3e756">Registers</h4>
<div class="outline-text-4" id="text-orgce3e756">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">Register</td>
<td class="org-left">Number</td>
<td class="org-left">Usage</td>
<td class="org-left">Avoid</td>
</tr>

<tr>
<td class="org-left">$zero</td>
<td class="org-left">$0</td>
<td class="org-left">Always zero</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">$at</td>
<td class="org-left">$1</td>
<td class="org-left">Assembler temporary register</td>
<td class="org-left">true</td>
</tr>

<tr>
<td class="org-left">$v0-$v1</td>
<td class="org-left">$2-$3</td>
<td class="org-left">functions results</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">$a0-$a3</td>
<td class="org-left">$4-$7</td>
<td class="org-left">function arguments</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">$t0-$t7</td>
<td class="org-left">$8-$15</td>
<td class="org-left">for storing temp. values</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">$s0-$s7</td>
<td class="org-left">$16-$23</td>
<td class="org-left">storing across function calls</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">$t8-$t9</td>
<td class="org-left">$24-$25</td>
<td class="org-left">for storing more temp. values</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">$k0-$k1</td>
<td class="org-left">$26-$27</td>
<td class="org-left">for kernel os use</td>
<td class="org-left">true</td>
</tr>

<tr>
<td class="org-left">$gp</td>
<td class="org-left">$28</td>
<td class="org-left">global (data) pointer register</td>
<td class="org-left">true</td>
</tr>

<tr>
<td class="org-left">$sp</td>
<td class="org-left">$29</td>
<td class="org-left">stack pointer (points to the top)</td>
<td class="org-left">true</td>
</tr>

<tr>
<td class="org-left">$fp</td>
<td class="org-left">$30</td>
<td class="org-left">frame pointer (points to stack frame)</td>
<td class="org-left">true</td>
</tr>

<tr>
<td class="org-left">$ra</td>
<td class="org-left">$31</td>
<td class="org-left">return address (return from fn call)</td>
<td class="org-left">true</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div id="outline-container-org2f131af" class="outline-3">
<h3 id="org2f131af">instructions</h3>
<div class="outline-text-3" id="text-org2f131af">
<p>
<a href="https://www.dsi.unive.it/~gasparetto/materials/MIPS_Instruction_Set.pdf">SIMPLER REF SHEET</a>
<a href="https://uweb.engr.arizona.edu/~ece369/Resources/spim/MIPSReference.pdf">MIPS REFERENCE SHEET</a>
</p>
</div>
</div>

<div id="outline-container-org0f7a16f" class="outline-3">
<h3 id="org0f7a16f">Labs</h3>
<div class="outline-text-3" id="text-org0f7a16f">
<p>
If you find any errors please submit a pull request
</p>
</div>
<div id="outline-container-org955b115" class="outline-4">
<h4 id="org955b115">LAB 3</h4>
<div class="outline-text-4" id="text-org955b115">
</div>
<ul class="org-ul">
<li><a id="orge72cf5e"></a>Task1<br />
<div class="outline-text-5" id="text-orge72cf5e">
<div class="org-src-container">
<pre class="src src-mips"><span style="color: #928374;"># </span><span style="color: #928374;">task1</span>
<span style="color: #928374;"># </span><span style="color: #928374;">get integer input </span>
<span style="color: #928374;"># </span><span style="color: #928374;">multiply with 53.125 </span>
<span style="color: #928374;"># </span><span style="color: #928374;">print result</span>

<span style="color: #ebdbb2; font-weight: bold;">.globl</span> main

<span style="color: #ebdbb2; font-weight: bold;">.data</span>
<span style="color: #b8bb26;">msg1:</span> <span style="color: #ebdbb2; font-weight: bold;">.asciiz</span> <span style="color: #b8bb26;">"Enter x: "</span>
<span style="color: #b8bb26;">msg2:</span> <span style="color: #ebdbb2; font-weight: bold;">.asciiz</span> <span style="color: #b8bb26;">"y = "</span>

<span style="color: #ebdbb2; font-weight: bold;">.text</span>
<span style="color: #b8bb26;">main:</span> 
    <span style="color: #928374;"># </span><span style="color: #928374;">print string input prompt</span>
    <span style="color: #83a598;">la</span> <span style="color: #fabd2f;">$a0</span><span style="color: #fe8019;">,</span> msg1
    <span style="color: #83a598;">li</span> <span style="color: #fabd2f;">$v0</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">4</span>
    <span style="color: #fb4934;">syscall</span>

    <span style="color: #928374;"># </span><span style="color: #928374;">read integer to $t0</span>
    <span style="color: #83a598;">li</span> <span style="color: #fabd2f;">$v0</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">5</span>
    <span style="color: #fb4934;">syscall</span>
    <span style="color: #83a598;">move</span> <span style="color: #fabd2f;">$t0</span><span style="color: #fe8019;">,</span> <span style="color: #fabd2f;">$v0</span>

    <span style="color: #928374;"># </span><span style="color: #928374;">.125 = x/8 = x &gt;&gt; 3</span>
    <span style="color: #fb4934;">sra</span> <span style="color: #fabd2f;">$t1</span><span style="color: #fe8019;">,</span> <span style="color: #fabd2f;">$t0</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">3</span> 
    

    <span style="color: #928374;"># </span><span style="color: #928374;">53 = 32 + 16 + 4 + 1  </span>
    <span style="color: #fb4934;">sll</span> <span style="color: #fabd2f;">$t2</span><span style="color: #fe8019;">,</span> <span style="color: #fabd2f;">$t0</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">5</span> <span style="color: #928374;"># </span><span style="color: #928374;">32x </span>
    <span style="color: #fb4934;">sll</span> <span style="color: #fabd2f;">$t3</span><span style="color: #fe8019;">,</span> <span style="color: #fabd2f;">$t0</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">4</span> <span style="color: #928374;"># </span><span style="color: #928374;">16x </span>
    <span style="color: #fb4934;">sll</span> <span style="color: #fabd2f;">$t4</span><span style="color: #fe8019;">,</span> <span style="color: #fabd2f;">$t0</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">2</span> <span style="color: #928374;"># </span><span style="color: #928374;">4x</span>

    <span style="color: #928374;"># </span><span style="color: #928374;">add results to $t0</span>
    <span style="color: #fb4934;">add</span> <span style="color: #fabd2f;">$t0</span><span style="color: #fe8019;">,</span> <span style="color: #fabd2f;">$t0</span><span style="color: #fe8019;">,</span> <span style="color: #fabd2f;">$t1</span> <span style="color: #928374;"># </span><span style="color: #928374;">adds the 1x + .125x</span>
    <span style="color: #fb4934;">add</span> <span style="color: #fabd2f;">$t0</span><span style="color: #fe8019;">,</span> <span style="color: #fabd2f;">$t0</span><span style="color: #fe8019;">,</span> <span style="color: #fabd2f;">$t2</span> <span style="color: #928374;"># </span><span style="color: #928374;">+= 32x</span>
    <span style="color: #fb4934;">add</span> <span style="color: #fabd2f;">$t0</span><span style="color: #fe8019;">,</span> <span style="color: #fabd2f;">$t0</span><span style="color: #fe8019;">,</span> <span style="color: #fabd2f;">$t3</span> <span style="color: #928374;"># </span><span style="color: #928374;">+= 16x</span>
    <span style="color: #fb4934;">add</span> <span style="color: #fabd2f;">$t0</span><span style="color: #fe8019;">,</span> <span style="color: #fabd2f;">$t0</span><span style="color: #fe8019;">,</span> <span style="color: #fabd2f;">$t4</span> <span style="color: #928374;"># </span><span style="color: #928374;">+= 4x</span>

    <span style="color: #928374;"># </span><span style="color: #928374;">print string output prompt</span>
    <span style="color: #83a598;">li</span>  <span style="color: #fabd2f;">$v0</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">4</span>
    <span style="color: #83a598;">la</span> <span style="color: #fabd2f;">$a0</span><span style="color: #fe8019;">,</span> msg2
    <span style="color: #fb4934;">syscall</span>

    <span style="color: #928374;"># </span><span style="color: #928374;">print result (result is already in $a0)</span>
    <span style="color: #83a598;">move</span> <span style="color: #fabd2f;">$a0</span><span style="color: #fe8019;">,</span> <span style="color: #fabd2f;">$t0</span>
    <span style="color: #83a598;">li</span> <span style="color: #fabd2f;">$v0</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">1</span>
    <span style="color: #fb4934;">syscall</span>

    <span style="color: #928374;"># </span><span style="color: #928374;">exit</span>
    <span style="color: #83a598;">li</span> <span style="color: #fabd2f;">$v0</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">10</span>
    <span style="color: #fb4934;">syscall</span>
</pre>
</div>
</div>
</li>

<li><a id="org8691017"></a>Task2<br />
<div class="outline-text-5" id="text-org8691017">
<div class="org-src-container">
<pre class="src src-mips"><span style="color: #928374;"># </span><span style="color: #928374;">task2 </span>
<span style="color: #928374;"># </span><span style="color: #928374;">get an integer input </span>
<span style="color: #928374;"># </span><span style="color: #928374;">set bit 11 and 17 to 1 </span>
<span style="color: #928374;"># </span><span style="color: #928374;">print the result integer</span>

<span style="color: #ebdbb2; font-weight: bold;">.globl</span> main

<span style="color: #ebdbb2; font-weight: bold;">.data</span>
<span style="color: #b8bb26;">msg1:</span> <span style="color: #ebdbb2; font-weight: bold;">.asciiz</span> <span style="color: #b8bb26;">"Enter a: "</span>
<span style="color: #b8bb26;">msg2:</span> <span style="color: #ebdbb2; font-weight: bold;">.asciiz</span> <span style="color: #b8bb26;">"Result = "</span>

<span style="color: #ebdbb2; font-weight: bold;">.text</span>
<span style="color: #b8bb26;">main:</span> 
    <span style="color: #928374;"># </span><span style="color: #928374;">print string input prompt</span>
    <span style="color: #83a598;">la</span> <span style="color: #fabd2f;">$a0</span><span style="color: #fe8019;">,</span> msg1
    <span style="color: #83a598;">li</span> <span style="color: #fabd2f;">$v0</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">4</span>
    <span style="color: #fb4934;">syscall</span>

    <span style="color: #928374;"># </span><span style="color: #928374;">read integer to $t0</span>
    <span style="color: #83a598;">li</span> <span style="color: #fabd2f;">$v0</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">5</span>
    <span style="color: #fb4934;">syscall</span>
    <span style="color: #83a598;">move</span> <span style="color: #fabd2f;">$t0</span><span style="color: #fe8019;">,</span> <span style="color: #fabd2f;">$v0</span>

    <span style="color: #928374;"># </span><span style="color: #928374;">set bit 11 and 17 to 1</span>
    <span style="color: #928374;"># </span><span style="color: #928374;">by ORing with a zeroed number except the</span>
    <span style="color: #928374;"># </span><span style="color: #928374;">bit locations</span>
    <span style="color: #fb4934;">ori</span> <span style="color: #fabd2f;">$t0</span><span style="color: #fe8019;">,</span> <span style="color: #fabd2f;">$t0</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">133120</span>

    <span style="color: #928374;"># </span><span style="color: #928374;">print string output prompt</span>
    <span style="color: #83a598;">li</span>  <span style="color: #fabd2f;">$v0</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">4</span>
    <span style="color: #83a598;">la</span> <span style="color: #fabd2f;">$a0</span><span style="color: #fe8019;">,</span> msg2
    <span style="color: #fb4934;">syscall</span>

    <span style="color: #928374;"># </span><span style="color: #928374;">print result (result is already in $a0)</span>
    <span style="color: #83a598;">move</span> <span style="color: #fabd2f;">$a0</span><span style="color: #fe8019;">,</span> <span style="color: #fabd2f;">$t0</span>
    <span style="color: #83a598;">li</span> <span style="color: #fabd2f;">$v0</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">1</span>
    <span style="color: #fb4934;">syscall</span>

    <span style="color: #928374;"># </span><span style="color: #928374;">exit</span>
    <span style="color: #83a598;">li</span> <span style="color: #fabd2f;">$v0</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">10</span>
    <span style="color: #fb4934;">syscall</span>
</pre>
</div>
</div>
</li>
</ul>
</div>
<div id="outline-container-org31ec7b0" class="outline-4">
<h4 id="org31ec7b0">LAB 4</h4>
<div class="outline-text-4" id="text-org31ec7b0">
</div>
<ul class="org-ul">
<li><a id="org66f7d3d"></a>Task1<br />
<div class="outline-text-5" id="text-org66f7d3d">
<div class="org-src-container">
<pre class="src src-mips"><span style="color: #ebdbb2; font-weight: bold;">.globl</span> main

<span style="color: #ebdbb2; font-weight: bold;">.data</span> 
<span style="color: #b8bb26;">msg:</span> <span style="color: #ebdbb2; font-weight: bold;">.asciiz</span> <span style="color: #b8bb26;">"Enter a character: "</span>
<span style="color: #b8bb26;">newline:</span> <span style="color: #ebdbb2; font-weight: bold;">.asciiz</span> <span style="color: #b8bb26;">"\n"</span>
<span style="color: #b8bb26;">lower:</span> <span style="color: #ebdbb2; font-weight: bold;">.asciiz</span> <span style="color: #b8bb26;">"Lowercase"</span>
<span style="color: #b8bb26;">upper:</span> <span style="color: #ebdbb2; font-weight: bold;">.asciiz</span> <span style="color: #b8bb26;">"Uppercase"</span>
<span style="color: #b8bb26;">digit:</span> <span style="color: #ebdbb2; font-weight: bold;">.asciiz</span> <span style="color: #b8bb26;">"Digit"</span> 
<span style="color: #b8bb26;">special:</span> <span style="color: #ebdbb2; font-weight: bold;">.asciiz</span> <span style="color: #b8bb26;">"Special Character"</span>


<span style="color: #ebdbb2; font-weight: bold;">.text</span> 
<span style="color: #928374;"># </span><span style="color: #928374;">psuedo code </span>
<span style="color: #928374;"># </span><span style="color: #928374;">if ('a' &lt;= c &amp;&amp; 'z' &gt;= c) return lower;</span>
<span style="color: #928374;"># </span><span style="color: #928374;">if ('A' &lt;= c &amp;&amp; 'Z' &gt;= c) return upper;</span>
<span style="color: #928374;"># </span><span style="color: #928374;">if ('0'&lt;= c &amp;&amp; '9' &gt;= c) return digit; </span>
<span style="color: #928374;"># </span><span style="color: #928374;">return special;</span>

<span style="color: #b8bb26;">main:</span>
    <span style="color: #83a598;">la</span> <span style="color: #fabd2f;">$a0</span><span style="color: #fe8019;">,</span> msg
    <span style="color: #83a598;">li</span> <span style="color: #fabd2f;">$v0</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">4</span> 
    <span style="color: #fb4934;">syscall</span> 
    
    <span style="color: #83a598;">li</span> <span style="color: #fabd2f;">$v0</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">12</span>  
    <span style="color: #fb4934;">syscall</span>
    <span style="color: #83a598;">move</span> <span style="color: #fabd2f;">$t0</span><span style="color: #fe8019;">,</span> <span style="color: #fabd2f;">$v0</span> <span style="color: #928374;"># </span><span style="color: #928374;">store </span>
    
    <span style="color: #928374;"># </span><span style="color: #928374;">print newline </span>
    <span style="color: #83a598;">li</span> <span style="color: #fabd2f;">$v0</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">4</span> 
    <span style="color: #83a598;">la</span> <span style="color: #fabd2f;">$a0</span><span style="color: #fe8019;">,</span> newline
    <span style="color: #fb4934;">syscall</span>

<span style="color: #928374;"># </span><span style="color: #928374;">c is t0   </span>
<span style="color: #928374;"># </span><span style="color: #928374;">if ('a' &lt;= c &amp;&amp; 'z' &gt;= c) return lower;</span>
    <span style="color: #83a598;">bge</span> <span style="color: #fabd2f;">$t0</span><span style="color: #fe8019;">,</span> 'a'<span style="color: #fe8019;">,</span> lower2
    <span style="color: #fb4934;">j</span> upper1
<span style="color: #b8bb26;">lower2:</span> 
    <span style="color: #83a598;">ble</span> <span style="color: #fabd2f;">$t0</span><span style="color: #fe8019;">,</span> 'z'<span style="color: #fe8019;">,</span> print_lower 
    
<span style="color: #928374;"># </span><span style="color: #928374;">if ('A' &lt;= c &amp;&amp; 'Z' &gt;= c) return upper;</span>
<span style="color: #b8bb26;">upper1:</span> 
    <span style="color: #83a598;">bge</span> <span style="color: #fabd2f;">$t0</span><span style="color: #fe8019;">,</span> 'A'<span style="color: #fe8019;">,</span> upper2
    <span style="color: #fb4934;">j</span> digit1
<span style="color: #b8bb26;">upper2:</span> 
    <span style="color: #83a598;">ble</span> <span style="color: #fabd2f;">$t0</span><span style="color: #fe8019;">,</span> 'Z'<span style="color: #fe8019;">,</span> print_upper 
    
<span style="color: #928374;"># </span><span style="color: #928374;">if ('0'&lt;= c &amp;&amp; '9' &gt;= c) return digit; </span>
<span style="color: #b8bb26;">digit1:</span> 
    <span style="color: #83a598;">bge</span> <span style="color: #fabd2f;">$t0</span><span style="color: #fe8019;">,</span> '<span style="color: #d3869b; font-weight: bold;">0</span>'<span style="color: #fe8019;">,</span> digit2
    <span style="color: #fb4934;">j</span> print_special
<span style="color: #b8bb26;">digit2:</span> 
    <span style="color: #83a598;">ble</span> <span style="color: #fabd2f;">$t0</span><span style="color: #fe8019;">,</span> '<span style="color: #d3869b; font-weight: bold;">9</span>'<span style="color: #fe8019;">,</span> print_digit
<span style="color: #928374;"># </span><span style="color: #928374;">else all are special;</span>
    <span style="color: #fb4934;">j</span> print_special 
    
<span style="color: #928374;"># </span><span style="color: #928374;">load the specific string for output prompt        </span>
<span style="color: #b8bb26;">print_lower:</span> 
    <span style="color: #83a598;">la</span> <span style="color: #fabd2f;">$a0</span><span style="color: #fe8019;">,</span> lower 
    <span style="color: #fb4934;">j</span> done_load
    
<span style="color: #b8bb26;">print_upper:</span> 
    <span style="color: #83a598;">la</span> <span style="color: #fabd2f;">$a0</span><span style="color: #fe8019;">,</span> upper   
    <span style="color: #fb4934;">j</span> done_load
    
<span style="color: #b8bb26;">print_digit:</span> 
    <span style="color: #83a598;">la</span> <span style="color: #fabd2f;">$a0</span><span style="color: #fe8019;">,</span> digit 
    <span style="color: #fb4934;">j</span> done_load

<span style="color: #b8bb26;">print_special:</span> 
    <span style="color: #83a598;">la</span> <span style="color: #fabd2f;">$a0</span><span style="color: #fe8019;">,</span> special 
    <span style="color: #fb4934;">j</span> done_load 
    
<span style="color: #b8bb26;">done_load:</span> 
    <span style="color: #928374;"># </span><span style="color: #928374;">print preloaded string address</span>
    <span style="color: #83a598;">li</span> <span style="color: #fabd2f;">$v0</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">4</span> 
    <span style="color: #fb4934;">syscall</span>
    
    <span style="color: #928374;"># </span><span style="color: #928374;">exit</span>
    <span style="color: #83a598;">li</span> <span style="color: #fabd2f;">$v0</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">10</span> 
    <span style="color: #fb4934;">syscall</span> 
</pre>
</div>
</div>
</li>
</ul>
</div>

<div id="outline-container-org5b7f456" class="outline-4">
<h4 id="org5b7f456">LAB 5</h4>
<div class="outline-text-4" id="text-org5b7f456">
</div>
<ul class="org-ul">
<li><a id="org88f8874"></a>Task1<br />
<div class="outline-text-5" id="text-org88f8874">
<div class="org-src-container">
<pre class="src src-mips"><span style="color: #928374;"># </span><span style="color: #928374;">TASK1</span>

<span style="color: #928374;"># </span><span style="color: #928374;">Write a MIPS assembly program that</span>
<span style="color: #928374;"># </span><span style="color: #928374;">reads the size (n) of the message from</span>
<span style="color: #928374;"># </span><span style="color: #928374;">the user. Then, the program allocates</span>
<span style="color: #928374;"># </span><span style="color: #928374;">(n+1) bytes in the heap. After that, read</span>
<span style="color: #928374;"># </span><span style="color: #928374;">a string of n characters from the user</span>
<span style="color: #928374;"># </span><span style="color: #928374;">he/she wishes to encrypt. Next, read</span>
<span style="color: #928374;"># </span><span style="color: #928374;">an encrypting key (e) from the user </span>
<span style="color: #928374;"># </span><span style="color: #928374;">Encrypt the original string with the</span>
<span style="color: #928374;"># </span><span style="color: #928374;">encryption key using the following code.</span>
<span style="color: #928374;"># </span><span style="color: #928374;">Finally, print out the encrypted string.</span>
<span style="color: #928374;"># </span>
<span style="color: #928374;">#</span>
<span style="color: #928374;">#</span>

<span style="color: #ebdbb2; font-weight: bold;">.globl</span> main

<span style="color: #ebdbb2; font-weight: bold;">.data</span> 
<span style="color: #b8bb26;">msg1:</span> <span style="color: #ebdbb2; font-weight: bold;">.asciiz</span> <span style="color: #b8bb26;">"Enter n: "</span>
<span style="color: #b8bb26;">msg2:</span> <span style="color: #ebdbb2; font-weight: bold;">.asciiz</span> <span style="color: #b8bb26;">"Enter string: "</span>
<span style="color: #b8bb26;">msg3:</span> <span style="color: #ebdbb2; font-weight: bold;">.asciiz</span> <span style="color: #b8bb26;">"Enter e: "</span>
<span style="color: #b8bb26;">msg4:</span> <span style="color: #ebdbb2; font-weight: bold;">.asciiz</span> <span style="color: #b8bb26;">"Encrypted string = "</span>


<span style="color: #ebdbb2; font-weight: bold;">.text</span>
<span style="color: #928374;"># </span><span style="color: #928374;">$t0 will hold the n </span>
<span style="color: #928374;"># </span><span style="color: #928374;">$t1 will hold the e </span>
<span style="color: #928374;"># </span><span style="color: #928374;">$t2 is the temp `ch` variable</span>
<span style="color: #928374;"># </span><span style="color: #928374;">$t3 is the address of the string</span>
<span style="color: #928374;"># </span><span style="color: #928374;">$t4 is the index in loop</span>



<span style="color: #b8bb26;">main:</span>
    <span style="color: #928374;"># </span><span style="color: #928374;">print string input prompt</span>
    <span style="color: #83a598;">li</span> <span style="color: #fabd2f;">$v0</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">4</span> 
    <span style="color: #83a598;">la</span> <span style="color: #fabd2f;">$a0</span><span style="color: #fe8019;">,</span> msg1
    <span style="color: #fb4934;">syscall</span>
    
    <span style="color: #928374;"># </span><span style="color: #928374;">$t0 &lt;- ask for integer input </span>
    <span style="color: #83a598;">li</span> <span style="color: #fabd2f;">$v0</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">5</span>
    <span style="color: #fb4934;">syscall</span>
    <span style="color: #83a598;">move</span> <span style="color: #fabd2f;">$t0</span><span style="color: #fe8019;">,</span> <span style="color: #fabd2f;">$v0</span>
    
    <span style="color: #928374;"># </span><span style="color: #928374;">print string input prompt for string</span>
    <span style="color: #83a598;">li</span> <span style="color: #fabd2f;">$v0</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">4</span> 
    <span style="color: #83a598;">la</span> <span style="color: #fabd2f;">$a0</span><span style="color: #fe8019;">,</span> msg2
    <span style="color: #fb4934;">syscall</span>
    
    <span style="color: #928374;"># </span><span style="color: #928374;">malloc((n | $t0)+1)</span>
    <span style="color: #83a598;">li</span> <span style="color: #fabd2f;">$v0</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">9</span>
    <span style="color: #fb4934;">addiu</span> <span style="color: #fabd2f;">$t0</span><span style="color: #fe8019;">,</span> <span style="color: #fabd2f;">$t0</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">1</span> <span style="color: #928374;"># </span><span style="color: #928374;">n++</span>
    <span style="color: #83a598;">move</span> <span style="color: #fabd2f;">$a0</span><span style="color: #fe8019;">,</span> <span style="color: #fabd2f;">$t0</span> <span style="color: #928374;"># </span><span style="color: #928374;">load memory size</span>
    <span style="color: #fb4934;">syscall</span> 
    <span style="color: #83a598;">move</span> <span style="color: #fabd2f;">$t3</span><span style="color: #fe8019;">,</span> <span style="color: #fabd2f;">$v0</span>
    
    <span style="color: #928374;"># </span><span style="color: #928374;">read string to memory</span>
    <span style="color: #83a598;">li</span> <span style="color: #fabd2f;">$v0</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">8</span>
    <span style="color: #83a598;">move</span> <span style="color: #fabd2f;">$a0</span><span style="color: #fe8019;">,</span> <span style="color: #fabd2f;">$t3</span>
    <span style="color: #83a598;">move</span> <span style="color: #fabd2f;">$a1</span><span style="color: #fe8019;">,</span> <span style="color: #fabd2f;">$t0</span> 
    <span style="color: #fb4934;">syscall</span>
    
    <span style="color: #928374;"># </span><span style="color: #928374;">print newline</span>
    <span style="color: #928374;">#</span><span style="color: #928374;">li $v0, 11</span>
    <span style="color: #928374;">#</span><span style="color: #928374;">li $a0, '\n'</span>
    <span style="color: #928374;">#</span><span style="color: #928374;">syscall  </span>
    
    
    <span style="color: #928374;"># </span><span style="color: #928374;">print string input prompt </span>
    <span style="color: #928374;"># </span><span style="color: #928374;">for encrypt key</span>
    <span style="color: #83a598;">li</span> <span style="color: #fabd2f;">$v0</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">4</span> 
    <span style="color: #83a598;">la</span> <span style="color: #fabd2f;">$a0</span><span style="color: #fe8019;">,</span> msg3
    <span style="color: #fb4934;">syscall</span>
    
    <span style="color: #928374;"># </span><span style="color: #928374;">input encryption key</span>
    <span style="color: #83a598;">li</span> <span style="color: #fabd2f;">$v0</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">5</span> 
    <span style="color: #fb4934;">syscall</span> 
    <span style="color: #83a598;">move</span> <span style="color: #fabd2f;">$t1</span><span style="color: #fe8019;">,</span> <span style="color: #fabd2f;">$v0</span>
    
    
    
    
<span style="color: #928374;"># </span><span style="color: #928374;">$t0 will hold the n </span>
<span style="color: #928374;"># </span><span style="color: #928374;">$t1 will hold the e </span>
<span style="color: #928374;"># </span><span style="color: #928374;">$t2 is the temp `ch` variable</span>
<span style="color: #928374;"># </span><span style="color: #928374;">$t3 is the address of the string</span>
<span style="color: #928374;"># </span><span style="color: #928374;">$t4 is the index in loop</span>
<span style="color: #928374;"># </span><span style="color: #928374;">$t5 pointer to indexed char</span>
    <span style="color: #928374;"># </span><span style="color: #928374;">PROGRAM BODY </span>
    <span style="color: #928374;"># </span><span style="color: #928374;">foreach (i; 0..&lt;n) {</span>
    <span style="color: #928374;">#   </span>
    <span style="color: #928374;"># </span><span style="color: #928374;">}</span>
    <span style="color: #83a598;">move</span> <span style="color: #fabd2f;">$t5</span><span style="color: #fe8019;">,</span> <span style="color: #fabd2f;">$t3</span> <span style="color: #928374;"># </span><span style="color: #928374;">t5 = &amp;str[0]</span>
    <span style="color: #83a598;">move</span> <span style="color: #fabd2f;">$t4</span><span style="color: #fe8019;">,</span> <span style="color: #fabd2f;">$0</span> <span style="color: #928374;"># </span><span style="color: #928374;">i=0 </span>
<span style="color: #b8bb26;">loop_body:</span>
    <span style="color: #fb4934;">lbu</span> <span style="color: #fabd2f;">$t2</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">0</span>(<span style="color: #fabd2f;">$t5</span>) <span style="color: #928374;"># </span><span style="color: #928374;">load char</span>
    <span style="color: #83a598;">blt</span> <span style="color: #fabd2f;">$t2</span><span style="color: #fe8019;">,</span> 'A'<span style="color: #fe8019;">,</span> endif 
    <span style="color: #83a598;">ble</span> <span style="color: #fabd2f;">$t2</span><span style="color: #fe8019;">,</span> 'Z'<span style="color: #fe8019;">,</span> elseif_upper
    
<span style="color: #928374;"># </span><span style="color: #928374;">islower   </span>
    <span style="color: #83a598;">bgt</span> <span style="color: #fabd2f;">$t2</span><span style="color: #fe8019;">,</span> 'z'<span style="color: #fe8019;">,</span> endif 
    <span style="color: #83a598;">blt</span> <span style="color: #fabd2f;">$t2</span><span style="color: #fe8019;">,</span> 'a'<span style="color: #fe8019;">,</span> endif 
    <span style="color: #fb4934;">addu</span> <span style="color: #fabd2f;">$t2</span><span style="color: #fe8019;">,</span> <span style="color: #fabd2f;">$t2</span><span style="color: #fe8019;">,</span> <span style="color: #fabd2f;">$t1</span> <span style="color: #928374;"># </span><span style="color: #928374;">ch += e</span>
    <span style="color: #83a598;">li</span> <span style="color: #fabd2f;">$t6</span><span style="color: #fe8019;">,</span> 0x7A  
    <span style="color: #83a598;">blt</span> <span style="color: #fabd2f;">$t2</span><span style="color: #fe8019;">,</span> <span style="color: #fabd2f;">$t6</span><span style="color: #fe8019;">,</span> endif <span style="color: #928374;"># </span><span style="color: #928374;">if ch &lt; 0x7A {goto endif}</span>
    subiu <span style="color: #fabd2f;">$t2</span><span style="color: #fe8019;">,</span> <span style="color: #fabd2f;">$t2</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">26</span> <span style="color: #928374;"># </span><span style="color: #928374;">ch -= 26</span>
    <span style="color: #fb4934;">j</span> endif
<span style="color: #928374;"># </span><span style="color: #928374;">isupper</span>
<span style="color: #b8bb26;">elseif_upper:</span>
    <span style="color: #fb4934;">addu</span> <span style="color: #fabd2f;">$t2</span><span style="color: #fe8019;">,</span> <span style="color: #fabd2f;">$t2</span><span style="color: #fe8019;">,</span> <span style="color: #fabd2f;">$t1</span> <span style="color: #928374;"># </span><span style="color: #928374;">ch += e</span>
    <span style="color: #83a598;">li</span> <span style="color: #fabd2f;">$t6</span><span style="color: #fe8019;">,</span> 0x5A
    <span style="color: #83a598;">blt</span> <span style="color: #fabd2f;">$t2</span><span style="color: #fe8019;">,</span> <span style="color: #fabd2f;">$t6</span><span style="color: #fe8019;">,</span> endif <span style="color: #928374;"># </span><span style="color: #928374;">if ch &lt; 0x5A {goto endif}</span>
    subiu <span style="color: #fabd2f;">$t2</span><span style="color: #fe8019;">,</span> <span style="color: #fabd2f;">$t2</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">26</span> <span style="color: #928374;"># </span><span style="color: #928374;">ch -= 26</span>
    
<span style="color: #b8bb26;">endif:</span>  
    <span style="color: #fb4934;">sb</span> <span style="color: #fabd2f;">$t2</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">0</span>(<span style="color: #fabd2f;">$t5</span>)
    <span style="color: #fb4934;">addiu</span> <span style="color: #fabd2f;">$t5</span><span style="color: #fe8019;">,</span> <span style="color: #fabd2f;">$t5</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">1</span> <span style="color: #928374;"># </span><span style="color: #928374;">ptr++</span>
    <span style="color: #fb4934;">addiu</span> <span style="color: #fabd2f;">$t4</span><span style="color: #fe8019;">,</span> <span style="color: #fabd2f;">$t4</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">1</span> <span style="color: #928374;"># </span><span style="color: #928374;">i++</span>
    <span style="color: #83a598;">blt</span> <span style="color: #fabd2f;">$t4</span><span style="color: #fe8019;">,</span> <span style="color: #fabd2f;">$t0</span><span style="color: #fe8019;">,</span> loop_body <span style="color: #928374;"># </span><span style="color: #928374;">check i&lt;n</span>
    
    <span style="color: #928374;"># </span><span style="color: #928374;">print final result prompt </span>
    <span style="color: #83a598;">li</span> <span style="color: #fabd2f;">$v0</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">4</span>
    <span style="color: #83a598;">la</span> <span style="color: #fabd2f;">$a0</span><span style="color: #fe8019;">,</span> msg4 
    <span style="color: #fb4934;">syscall</span> 
    
    <span style="color: #928374;"># </span><span style="color: #928374;">print final result string</span>
    <span style="color: #83a598;">li</span> <span style="color: #fabd2f;">$v0</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">4</span> 
    <span style="color: #83a598;">move</span> <span style="color: #fabd2f;">$a0</span><span style="color: #fe8019;">,</span> <span style="color: #fabd2f;">$t3</span>
    <span style="color: #fb4934;">syscall</span>
    
    
    <span style="color: #928374;"># </span><span style="color: #928374;">exit</span>
    <span style="color: #83a598;">li</span> <span style="color: #fabd2f;">$v0</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">10</span>
    <span style="color: #fb4934;">syscall</span> 
</pre>
</div>
</div>
</li>

<li><a id="org5b2e84c"></a>Task2<br />
<div class="outline-text-5" id="text-org5b2e84c">
<div class="org-src-container">
<pre class="src src-mips"><span style="color: #928374;"># </span><span style="color: #928374;">Task2 </span>

<span style="color: #928374;"># </span><span style="color: #928374;">Write a MIPS assembly program that asks the</span>
<span style="color: #928374;"># </span><span style="color: #928374;">user for file name (max 50 chars). Open the</span>
<span style="color: #928374;"># </span><span style="color: #928374;">file for reading. Next, read the file contents</span>
<span style="color: #928374;"># </span><span style="color: #928374;">as characters (max 100 chars). After that,</span>
<span style="color: #928374;"># </span><span style="color: #928374;">loop over each character, if the character is</span>
<span style="color: #928374;"># </span><span style="color: #928374;">a digit (i.e. &#8216;0&#8217; to &#8216;9&#8217;), convert it to integer and</span>
<span style="color: #928374;"># </span><span style="color: #928374;">store it in another array called &#8220;array int&#8221;.</span>
<span style="color: #928374;"># </span><span style="color: #928374;">Assume the maximum number of integers</span>
<span style="color: #928374;"># </span><span style="color: #928374;">in the file is 20. Finally, print &#8220;array int&#8221; in</span>
<span style="color: #928374;"># </span><span style="color: #928374;">reverse order.</span>

<span style="color: #ebdbb2; font-weight: bold;">.globl</span> main

<span style="color: #928374;"># </span><span style="color: #928374;">define constants</span>
.eqv FILE_READ <span style="color: #d3869b; font-weight: bold;">0</span>


<span style="color: #ebdbb2; font-weight: bold;">.data</span> <span style="color: #928374;"># </span><span style="color: #928374;">static data segment</span>
<span style="color: #b8bb26;">msg1:</span> <span style="color: #ebdbb2; font-weight: bold;">.asciiz</span> <span style="color: #b8bb26;">"Enter filename: "</span>
<span style="color: #b8bb26;">msg2:</span> <span style="color: #ebdbb2; font-weight: bold;">.asciiz</span> <span style="color: #b8bb26;">"Integer array reversed = "</span>
<span style="color: #b8bb26;">msg3:</span> <span style="color: #ebdbb2; font-weight: bold;">.asciiz</span> <span style="color: #b8bb26;">"File open error\nProbably file doesnt exist\n"</span>
<span style="color: #b8bb26;">msg4:</span> <span style="color: #ebdbb2; font-weight: bold;">.asciiz</span> <span style="color: #b8bb26;">"File read error\nI cant read this file\n"</span> 
<span style="color: #b8bb26;">filename:</span> <span style="color: #ebdbb2; font-weight: bold;">.space</span> <span style="color: #d3869b; font-weight: bold;">50</span>
<span style="color: #b8bb26;">filecontents:</span> <span style="color: #ebdbb2; font-weight: bold;">.space</span> <span style="color: #d3869b; font-weight: bold;">100</span>
<span style="color: #b8bb26;">array_int:</span> <span style="color: #ebdbb2; font-weight: bold;">.word</span> <span style="color: #d3869b; font-weight: bold;">0</span><span style="color: #fe8019;">:</span><span style="color: #d3869b; font-weight: bold;">20</span>

<span style="color: #ebdbb2; font-weight: bold;">.text</span> 
<span style="color: #b8bb26;">main:</span> 
    <span style="color: #928374;"># </span><span style="color: #928374;">print string input prompt</span>
    <span style="color: #83a598;">li</span> <span style="color: #fabd2f;">$v0</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">4</span>
    <span style="color: #83a598;">la</span> <span style="color: #fabd2f;">$a0</span><span style="color: #fe8019;">,</span> msg1
    <span style="color: #fb4934;">syscall</span>
    
    <span style="color: #928374;"># </span><span style="color: #928374;">read string filename </span>
    <span style="color: #83a598;">li</span> <span style="color: #fabd2f;">$v0</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">8</span>
    <span style="color: #83a598;">la</span> <span style="color: #fabd2f;">$a0</span><span style="color: #fe8019;">,</span> filename
    <span style="color: #83a598;">li</span> <span style="color: #fabd2f;">$a1</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">49</span>
    <span style="color: #fb4934;">syscall</span> 
    
<span style="color: #928374;"># </span><span style="color: #928374;">fix file name</span>
    <span style="color: #83a598;">la</span> <span style="color: #fabd2f;">$t1</span><span style="color: #fe8019;">,</span> filename
    <span style="color: #83a598;">li</span> <span style="color: #fabd2f;">$s0</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">0</span>               <span style="color: #928374;"># </span><span style="color: #928374;">i=0</span>
<span style="color: #b8bb26;">remove:</span>
    <span style="color: #fb4934;">lb</span> <span style="color: #fabd2f;">$a3</span><span style="color: #fe8019;">,</span> filename(<span style="color: #fabd2f;">$s0</span>)      <span style="color: #928374;"># </span><span style="color: #928374;">Load character at index</span>
    <span style="color: #fb4934;">addi</span> <span style="color: #fabd2f;">$s0</span><span style="color: #fe8019;">,</span> <span style="color: #fabd2f;">$s0</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">1</span>        <span style="color: #928374;"># </span><span style="color: #928374;">i++</span>
    <span style="color: #83a598;">bnez</span> <span style="color: #fabd2f;">$a3</span><span style="color: #fe8019;">,</span> remove   
    <span style="color: #fb4934;">beq</span> <span style="color: #fabd2f;">$a1</span><span style="color: #fe8019;">,</span> <span style="color: #fabd2f;">$s0</span><span style="color: #fe8019;">,</span> skip      
    subiu <span style="color: #fabd2f;">$s0</span><span style="color: #fe8019;">,</span> <span style="color: #fabd2f;">$s0</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">2</span>     <span style="color: #928374;"># </span><span style="color: #928374;">assuming '\n' is before the last char</span>
    <span style="color: #fb4934;">sb</span> <span style="color: #fabd2f;">$0</span><span style="color: #fe8019;">,</span> filename(<span style="color: #fabd2f;">$s0</span>)        <span style="color: #928374;"># </span><span style="color: #928374;">Add the terminating character in its place</span>
<span style="color: #b8bb26;">skip:</span>

    <span style="color: #928374;"># </span><span style="color: #928374;">open file </span>
    <span style="color: #83a598;">li</span> <span style="color: #fabd2f;">$v0</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">13</span>
    <span style="color: #83a598;">li</span> <span style="color: #fabd2f;">$a1</span><span style="color: #fe8019;">,</span> FILE_READ
    <span style="color: #83a598;">la</span> <span style="color: #fabd2f;">$a0</span><span style="color: #fe8019;">,</span> filename
    <span style="color: #fb4934;">syscall</span> 
    <span style="color: #83a598;">blt</span> <span style="color: #fabd2f;">$v0</span><span style="color: #fe8019;">,</span> <span style="color: #fabd2f;">$zero</span><span style="color: #fe8019;">,</span> file_open_err <span style="color: #928374;"># </span><span style="color: #928374;">assert file open</span>

    <span style="color: #928374;"># </span><span style="color: #928374;">read file </span>
    <span style="color: #83a598;">move</span> <span style="color: #fabd2f;">$a0</span><span style="color: #fe8019;">,</span> <span style="color: #fabd2f;">$v0</span> 
    <span style="color: #83a598;">li</span> <span style="color: #fabd2f;">$v0</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">14</span>
    <span style="color: #83a598;">la</span> <span style="color: #fabd2f;">$a1</span><span style="color: #fe8019;">,</span> filecontents
    <span style="color: #83a598;">li</span> <span style="color: #fabd2f;">$a2</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">99</span>
    <span style="color: #fb4934;">syscall</span> 
    <span style="color: #83a598;">move</span> <span style="color: #fabd2f;">$t0</span><span style="color: #fe8019;">,</span> <span style="color: #fabd2f;">$v0</span> <span style="color: #928374;"># </span><span style="color: #928374;">len in t0 </span>

    <span style="color: #928374;"># </span><span style="color: #928374;">assert file open</span>
    <span style="color: #83a598;">blt</span> <span style="color: #fabd2f;">$v0</span><span style="color: #fe8019;">,</span> <span style="color: #fabd2f;">$zero</span><span style="color: #fe8019;">,</span> file_read_err 
    
    <span style="color: #928374;"># </span><span style="color: #928374;">str[len]=0; // add null char</span>
    <span style="color: #fb4934;">sb</span> <span style="color: #fabd2f;">$0</span><span style="color: #fe8019;">,</span> filecontents+99 
    
<span style="color: #928374;"># </span><span style="color: #928374;">foreach() {</span>
<span style="color: #928374;">#   </span><span style="color: #928374;">if ch == '\0'{ break; } </span>
<span style="color: #928374;">#   </span><span style="color: #928374;">if ch &gt;= '0' &amp;&amp; ch &lt;= '9' { </span>
<span style="color: #928374;">#       </span><span style="color: #928374;">add ch to array</span>
<span style="color: #928374;"># </span>
<span style="color: #928374;">#   </span><span style="color: #928374;">}</span>
<span style="color: #928374;">#   </span><span style="color: #928374;">continue</span>
<span style="color: #928374;"># </span><span style="color: #928374;">}</span>
<span style="color: #928374;"># </span><span style="color: #928374;">$t0: file length </span>
<span style="color: #928374;"># </span><span style="color: #928374;">$t1: index </span>
<span style="color: #928374;"># </span><span style="color: #928374;">$t2: string ptr </span>
<span style="color: #928374;"># </span><span style="color: #928374;">$t3: ch</span>
    <span style="color: #83a598;">move</span> <span style="color: #fabd2f;">$t1</span><span style="color: #fe8019;">,</span> <span style="color: #fabd2f;">$zero</span> <span style="color: #928374;"># </span><span style="color: #928374;">i=0</span>
    <span style="color: #83a598;">move</span> <span style="color: #fabd2f;">$t6</span><span style="color: #fe8019;">,</span> <span style="color: #fabd2f;">$zero</span> <span style="color: #928374;"># </span><span style="color: #928374;">arrlen</span>
    <span style="color: #83a598;">la</span> <span style="color: #fabd2f;">$t2</span><span style="color: #fe8019;">,</span> filecontents <span style="color: #928374;"># </span><span style="color: #928374;">file ptr</span>
    <span style="color: #83a598;">li</span> <span style="color: #fabd2f;">$t4</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">20</span>
    <span style="color: #83a598;">la</span> <span style="color: #fabd2f;">$t5</span><span style="color: #fe8019;">,</span> array_int
<span style="color: #b8bb26;">loop:</span>
    <span style="color: #928374;">#</span><span style="color: #928374;">bge $t1, $t4, exitloop         </span>
    <span style="color: #fb4934;">lbu</span> <span style="color: #fabd2f;">$t3</span><span style="color: #fe8019;">,</span> (<span style="color: #fabd2f;">$t2</span>) <span style="color: #928374;"># </span><span style="color: #928374;">load char </span>
    <span style="color: #fb4934;">beq</span> <span style="color: #fabd2f;">$t3</span><span style="color: #fe8019;">,</span> <span style="color: #fabd2f;">$0</span><span style="color: #fe8019;">,</span> exitloop <span style="color: #928374;"># </span><span style="color: #928374;">exit if null char</span>
    <span style="color: #83a598;">blt</span> <span style="color: #fabd2f;">$t3</span><span style="color: #fe8019;">,</span> '<span style="color: #d3869b; font-weight: bold;">0</span>'<span style="color: #fe8019;">,</span> inc <span style="color: #928374;"># </span><span style="color: #928374;">check if less than 0</span>
    <span style="color: #83a598;">bgt</span> <span style="color: #fabd2f;">$t3</span><span style="color: #fe8019;">,</span> '<span style="color: #d3869b; font-weight: bold;">9</span>'<span style="color: #fe8019;">,</span> inc <span style="color: #928374;"># </span><span style="color: #928374;">check if greater than 9</span>
    
    
<span style="color: #b8bb26;">save:</span> <span style="color: #928374;">#</span><span style="color: #928374;">save word </span>
    subiu <span style="color: #fabd2f;">$t3</span><span style="color: #fe8019;">,</span> <span style="color: #fabd2f;">$t3</span><span style="color: #fe8019;">,</span> '<span style="color: #d3869b; font-weight: bold;">0</span>' <span style="color: #928374;"># </span><span style="color: #928374;">to get the original value</span>
    <span style="color: #fb4934;">sw</span> <span style="color: #fabd2f;">$t3</span><span style="color: #fe8019;">,</span> (<span style="color: #fabd2f;">$t5</span>) 
    <span style="color: #fb4934;">addiu</span> <span style="color: #fabd2f;">$t5</span><span style="color: #fe8019;">,</span> <span style="color: #fabd2f;">$t5</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">4</span>
    <span style="color: #fb4934;">addiu</span> <span style="color: #fabd2f;">$t6</span><span style="color: #fe8019;">,</span> <span style="color: #fabd2f;">$t6</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">1</span>

<span style="color: #b8bb26;">inc:</span> <span style="color: #928374;">#</span><span style="color: #928374;">i++ and ptrs++</span>
    
    <span style="color: #fb4934;">addiu</span> <span style="color: #fabd2f;">$t1</span><span style="color: #fe8019;">,</span> <span style="color: #fabd2f;">$t1</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">1</span> <span style="color: #928374;"># </span><span style="color: #928374;">i++</span>
    <span style="color: #fb4934;">addiu</span> <span style="color: #fabd2f;">$t2</span><span style="color: #fe8019;">,</span> <span style="color: #fabd2f;">$t2</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">1</span> <span style="color: #928374;"># </span><span style="color: #928374;">file ptr++</span>
    <span style="color: #fb4934;">j</span> loop

<span style="color: #b8bb26;">exitloop:</span>   

    <span style="color: #928374;"># </span><span style="color: #928374;">print string result prompt</span>
    <span style="color: #83a598;">li</span> <span style="color: #fabd2f;">$v0</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">4</span> 
    <span style="color: #83a598;">la</span> <span style="color: #fabd2f;">$a0</span><span style="color: #fe8019;">,</span> msg2 
    <span style="color: #fb4934;">syscall</span>

<span style="color: #928374;"># </span><span style="color: #928374;">for (i = len-1; i &gt;=0; i--) { }   </span>
<span style="color: #928374;"># </span><span style="color: #928374;">print int array reversed</span>
    subiu <span style="color: #fabd2f;">$t6</span><span style="color: #fe8019;">,</span> <span style="color: #fabd2f;">$t6</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">1</span>
    <span style="color: #928374;"># </span><span style="color: #928374;">if len = 0 no res</span>
    <span style="color: #fb4934;">beq</span> <span style="color: #fabd2f;">$t6</span><span style="color: #fe8019;">,</span> <span style="color: #fabd2f;">$zero</span><span style="color: #fe8019;">,</span> endrev
    
<span style="color: #b8bb26;">rev:</span> 
    <span style="color: #fb4934;">sll</span> <span style="color: #fabd2f;">$t2</span><span style="color: #fe8019;">,</span> <span style="color: #fabd2f;">$t6</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">2</span> <span style="color: #928374;"># </span><span style="color: #928374;">i*4</span>
    <span style="color: #83a598;">la</span> <span style="color: #fabd2f;">$t3</span><span style="color: #fe8019;">,</span> array_int
    <span style="color: #fb4934;">addu</span> <span style="color: #fabd2f;">$t2</span><span style="color: #fe8019;">,</span> <span style="color: #fabd2f;">$t3</span><span style="color: #fe8019;">,</span> <span style="color: #fabd2f;">$t2</span> 
    
    <span style="color: #fb4934;">lw</span> <span style="color: #fabd2f;">$a0</span><span style="color: #fe8019;">,</span> (<span style="color: #fabd2f;">$t2</span>)
    <span style="color: #83a598;">li</span> <span style="color: #fabd2f;">$v0</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">1</span> 
    <span style="color: #fb4934;">syscall</span> 
    
    <span style="color: #83a598;">blt</span> <span style="color: #fabd2f;">$t6</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">0</span><span style="color: #fe8019;">,</span> endrev
    <span style="color: #928374;"># </span><span style="color: #928374;">print space</span>
    <span style="color: #83a598;">li</span> <span style="color: #fabd2f;">$v0</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">11</span> 
    <span style="color: #83a598;">li</span> <span style="color: #fabd2f;">$a0</span><span style="color: #fe8019;">,</span> ' '
    <span style="color: #fb4934;">syscall</span> 
    
    subiu <span style="color: #fabd2f;">$t6</span><span style="color: #fe8019;">,</span> <span style="color: #fabd2f;">$t6</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">1</span>
    <span style="color: #fb4934;">bne</span> <span style="color: #fabd2f;">$t6</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b;">-1</span><span style="color: #fe8019;">,</span> rev
<span style="color: #b8bb26;">endrev:</span> 
    
    <span style="color: #928374;"># </span><span style="color: #928374;">exit</span>
    <span style="color: #83a598;">li</span> <span style="color: #fabd2f;">$v0</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">10</span> 
    <span style="color: #fb4934;">syscall</span> 
    
<span style="color: #928374;"># </span><span style="color: #928374;">error msgs segment    </span>
<span style="color: #b8bb26;">file_open_err:</span>
    <span style="color: #83a598;">la</span> <span style="color: #fabd2f;">$a0</span><span style="color: #fe8019;">,</span> msg3 
    <span style="color: #fb4934;">j</span> file_err
<span style="color: #b8bb26;">file_read_err:</span>
    <span style="color: #83a598;">la</span> <span style="color: #fabd2f;">$a0</span><span style="color: #fe8019;">,</span> msg4 
<span style="color: #b8bb26;">file_err:</span> 
    <span style="color: #928374;"># </span><span style="color: #928374;">print preloaded string</span>
    <span style="color: #83a598;">li</span> <span style="color: #fabd2f;">$v0</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">4</span> 
    <span style="color: #fb4934;">syscall</span> 
    
    <span style="color: #928374;"># </span><span style="color: #928374;">exit</span>
    <span style="color: #83a598;">li</span> <span style="color: #fabd2f;">$v0</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">10</span> 
    <span style="color: #fb4934;">syscall</span>
</pre>
</div>
</div>
</li>
</ul>
</div>
</div>

<div id="outline-container-org56a717e" class="outline-3">
<h3 id="org56a717e">Useful Macros</h3>
<div class="outline-text-3" id="text-org56a717e">
<p>
use these to develop code faster
</p>
<div class="org-src-container">
<pre class="src src-mips"><span style="color: #928374;"># </span><span style="color: #b8bb26; font-weight: bold;">NOTE:</span><span style="color: #928374;"> useful macros for general development  </span>


<span style="color: #928374;"># </span><span style="color: #928374;">exit program</span>
<span style="color: #928374;"># </span><span style="color: #928374;">no params required</span>
.macro exit() 
    <span style="color: #83a598;">li</span> <span style="color: #fabd2f;">$v0</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">10</span>
    <span style="color: #fb4934;">syscall</span>
.end_macro

<span style="color: #928374;"># </span><span style="color: #928374;">print strings</span>
<span style="color: #928374;"># </span><span style="color: #928374;">param(s): string address</span>
.macro print_str(%s)
    <span style="color: #83a598;">la</span> <span style="color: #fabd2f;">$a0</span><span style="color: #fe8019;">,</span> %s
    <span style="color: #83a598;">li</span> <span style="color: #fabd2f;">$v0</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">4</span>
    <span style="color: #fb4934;">syscall</span>
.end_macro

<span style="color: #928374;"># </span><span style="color: #928374;">print string literals</span>
<span style="color: #928374;"># </span><span style="color: #928374;">param(s): string literal</span>
.macro print_strlit(%s)
<span style="color: #ebdbb2; font-weight: bold;">.data</span>
<span style="color: #b8bb26;">string_pointer:</span> <span style="color: #ebdbb2; font-weight: bold;">.asciiz</span> %s
<span style="color: #ebdbb2; font-weight: bold;">.text</span>
    <span style="color: #83a598;">la</span> <span style="color: #fabd2f;">$a0</span><span style="color: #fe8019;">,</span> string_pointer
    <span style="color: #83a598;">li</span> <span style="color: #fabd2f;">$v0</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">4</span>
    <span style="color: #fb4934;">syscall</span>
.end_macro

<span style="color: #928374;"># </span><span style="color: #928374;">print int</span>
<span style="color: #928374;"># </span><span style="color: #928374;">param(d): int register</span>
.macro print_int(%d)
    <span style="color: #83a598;">la</span> <span style="color: #fabd2f;">$a0</span><span style="color: #fe8019;">,</span> %d
    <span style="color: #83a598;">li</span> <span style="color: #fabd2f;">$v0</span><span style="color: #fe8019;">,</span> <span style="color: #d3869b; font-weight: bold;">1</span>
    <span style="color: #fb4934;">syscall</span>
.end_macro

<span style="color: #928374;"># </span><span style="color: #fabd2f; font-weight: bold;">TODO:</span>
<span style="color: #928374;"># </span><span style="color: #928374;">- for loop (maybe?)</span>
</pre>
</div>
</div>
</div>
</div>
</div>
</body>
</html>